# 起步 #

* 了解一些版本控制工具的历史背景
* 安装，让 Git 在系统上跑起来
* 直到最后配置好，可以正常开始使用

## 关于版本控制 ##

版本控制是一种记录文件/ 项目内容变化，以便将来查阅特定版本修改情况的系统，你可以对任何类型的文件进行版本控制。

* 你就可以将某个文件回溯到之前的状态
* 你可以比较文件的变化细节，查出最后是谁修改了哪个地方


### 本地版本控制系统 ###

怎么做文件版本管理？

本地版本控制系统，大多都是在本机上采用简单的数据库来记录文件的历次更新差异（见图 1-1）。

![18333fig0101](figures/18333fig0101-tn.png){:caption="本地版本控制系统"}


### 集中化的版本控制系统 ###

接下来人们又遇到一个问题，如何让在不同系统上的开发者协同工作？于是，集中化的版本控制系统（Centralized Version Control Systems，简称 CVCS）应运而生。这类系统，诸如 CVS，SVN，都有一个单一的集中管理的服务器，保存所有文件的修订版本，而协同工作的人们都通过客户端连到这台服务器，取出最新的文件或者提交更新。（见图 1-2）。

![18333fig0102](figures/18333fig0102-tn.png){:caption="集中化的版本控制系统"}

好处：

- 管理员也可以轻松掌控每个开发者的权限
- 只需管理一个 svn 服务器

坏处：

- 单点故障，数据丢失


### 分布式版本控制系统 ###

于是分布式版本控制系统（Distributed Version Control System，简称 DVCS）面世了。在这类系统中，像 Git 

- 客户端把代码仓库完整地镜像下来
- 任何一处协同工作用的服务器发生故障，事后都可以用任何一个镜像出来的本地仓库恢复

![18333fig0103](figures/18333fig0103-tn.png){:caption="分布式版本控制系统"}


## Git 简史 ##

- 1991－2002, Linux 项目组用分布式版本控制系统 BitKeeper 来管理和维护代码
- 2005，开发 BitKeeper 的商业公司与 Linux 内核开源社区结束合作关系，收回了免费使用 BitKeeper 的权力
- Linux 开源社区（特别是 Linux 的缔造者 Linus Torvalds）吸取教训，开发一套属于自己的版本控制系统。他们对新的系统制订了若干目标(好处)：

	* 速度
	* 简单的设计
	* 对非线性开发模式的强力支持（允许上千个并行开发的分支）
	* 完全分布式
	* 有能力高效管理类似 Linux 内核一样的超大规模项目（速度和数据量）


## Git 基础 ##



### 直接记录快照，而非差异比较 ###

Git 和其他版本控制系统的主要差别在于，Git 只关心文件数据的整体是否发生变化，而大多数其他系统则只关心文件内容的具体差异。请看图 1-4。

![18333fig0104](figures/18333fig0104-tn.png){:caption="其他系统在每个版本中记录着各个文件的具体差异"}

Git 更像把变化的文件作快照后，记录在一个微型的文件系统中。每次提交更新时，它会遍历所有文件的指纹信息并对文件作一快照，然后保存一个指向这次快照的索引。若文件没有变化，Git 不会再次保存，而只对上次保存的快照作索引。Git 的工作方式就像图 1-5 所示。

![18333fig0105](figures/18333fig0105-tn.png){:caption="Git 保存每次更新时的文件快照"}

### 近乎所有操作都是本地执行 ###

在 Git 中的绝大多数操作都只需要访问本地文件和资源，不用连网


### 时刻保持数据完整性 ###

在保存到 Git 之前，所有数据都要进行内容的校验和（checksum）计算，并将此结果作为数据的唯一标识和索引。换句话说，你修改了文件或目录之后，Git 立刻所知。

Git 使用 SHA-1 算法计算数据的校验和，通过对文件的内容或目录的结构计算出一个 SHA-1 哈希值，作为指纹字符串，长这样：

	24b9da6552252987aa493b52f8696cd6d3b00373

Git 的工作完全依赖于这类指纹字串，所以你会经常看到这样的哈希值。实际上，所有保存在 Git 数据库中的东西都是用此哈希值来作索引的，而不是靠文件名。

### 多数操作仅添加数据 ###

常用的 Git 操作大多仅仅是把数据添加到数据库。因为任何一种不可逆的操作，比如删除数据，都会使回退或重现历史版本变得困难重重。一旦提交快照之后就完全不用担心丢失数据，特别是养成定期推送到其他仓库的习惯的话。

### 文件的三种状态 ###

- 已提交（committed）: 该文件已经被安全地保存在本地数据库中了
- 已修改（modified）：修改了某个文件，但还没有提交保存
- 已暂存（staged）：已修改的文件放在下次提交时要保存的清单中

![18333fig0106](figures/18333fig0106-tn.png){:caption="工作目录，暂存区域，以及本地仓库"}

每个项目都有一个 .git，它是 Git 用来保存元数据和对象数据库的地方。每次克隆镜像仓库的时候，实际拷贝的就是这个目录里面的数据。

从项目中取出某个版本的所有文件和目录，用以开始后续工作的叫做工作目录。这些文件实际上都是从 .git 目录中的压缩对象数据库中提取出来的。

所谓的暂存区域只不过是个简单的文件，一般都放在 .git 目录中。

基本的 Git 工作流程如下：

1. 在工作目录中修改某些文件。
2. 对修改后的文件进行快照，然后保存到暂存区域。
3. 提交更新，将保存在暂存区域的文件快照永久转储到 Git 目录中。

## 在 Windows 上安装 ###

在 Windows 上安装 Git 同样轻松，有个叫做 msysGit 的项目提供了安装包，可以到 GitHub 的页面上下载 exe 安装文件并运行：

	http://msysgit.github.com/

完成安装之后，就可以使用命令行的 `git` 工具（已经自带了 ssh 客户端）了，另外还有一个图形界面的 Git 项目管理工具。

## 初次运行 Git 前的配置 ##

git config 的工具，专门用来配置或读取相应的工作环境变量。这些变量存在三种级别环境中（下面的覆盖上面）：

* 系统级别 ： ` --system` 
* 用户系别 ： ` --global` 
* 当前项目级别：存在 `.git/config` 文件中 

### 用户信息 ###

配置用户的`name`和`email`。这两条配置很重要，每次 Git 提交时都会引用这两条信息，说明是谁提交了更新：

	$ git config --global user.name "John Doe"
	$ git config --global user.email johndoe@example.com

### 文本编辑器 ###

接下来要设置的是默认使用的文本编辑器。Git 需要你输入一些额外消息的时候，会自动调用一个外部文本编辑器给你用。默认会使用操作系统指定的默认编辑器，一般可能会是 Vi 或者 Vim。如果你有其他偏好，比如 Emacs 的话，可以重新设置：

	$ git config --global core.editor emacs
	$ git config --global core.editor "'D:\IDE\SublimeText 2\sublime_text.exe' -w"

### 查看配置信息 ###

要检查已有的配置信息，可以使用 `git config --list` 命令：

	$ git config --list
	user.name=Scott Chacon
	user.email=schacon@gmail.com
	color.status=auto
	color.branch=auto
	color.interactive=auto
	color.diff=auto
	...

## 获取帮助 ##

想了解 Git 的各式工具该怎么用，可以阅读它们的使用帮助，方法有三：

	$ git help <verb>
	$ git <verb> --help
	$ man git-<verb>

比如，要学习 config 命令可以怎么用，运行：

	$ git help config
